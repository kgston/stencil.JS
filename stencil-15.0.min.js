/*
 stencil.js
 version 15 - 02 Feb 2015
 Kingston Chan - Released under the MIT licence
 https://github.com/kgston/stencil.JS
*/
var stencil=stencil||{};stencil.opts=$.extend(stencil.opts||{},function(){return{debug:!0,defaultOutputElement:"stencil-output",fetchTimeout:3E3,ieNs:""}}());
stencil=$.extend(stencil||{},function(){return{stencilHolder:{},fetch:function(a,d){if(null==a)stencil.util.log("Stencil: No valid URL was passed in");else{var c=$.Deferred();$.ajax({url:a,method:"GET",dataType:"html",timeout:stencil.opts.fetchTimeout}).done(function(b){b=b.replace(/\x3c!--((.|\n)*?)--\x3e/gm,"");var e=$(b);0===e.length&&stencil.util.log("Stencil: Unable to parse fetched template at <"+a+">");var k=[];e.each(function(b){"STENCIL"!==this.nodeName&&stencil.util.log("Stencil: Fetched template("+
(b+1)+"/"+e.length+") at <"+a+"> is not a stencil template");b=$(this);d=d||b.attr("data-stencilDestination")||"none";b=stencil.define(b.attr("id"),d,null,b);k.push(b);c.notify(b)});c.resolve(k)}).fail(function(b){stencil.util.log("Stencil: Failed to fetched template at <"+a+"> due to "+b.status+":"+b.statusText)});return c.promise()}},define:function(a,d,c,b){var e=function(b,a,c){return{guid:stencil.util.guid(),tagID:b,template:c,childStencils:{},isStandard:!0,destination:a,existingContent:"",clear:function(){$(this.destination).empty().append(this.existingContent)},
getChild:function(b){var a=this.childStencils,c=null;if(0===Object.keys(a).length)return null;0<=Object.keys(a).indexOf(b)?c=a[b]:Object.keys(a).every(function(d){d=a[d].getChild(b);if(null==d)return!0;c=d;return!1});return c},render:function(a,b,c){if(!Array.isArray(a))if(stencil.util.isObject(a))a=[a];else return"undefined"===typeof a?stencil.util.log("Stencil - "+this.tagID+": has no data, skipping..."):stencil.util.log("Stencil - "+this.tagID+": dataset in an invalid format, detected: "+typeof a),
!1;else if(null==a||0===a.length)return stencil.util.log("Stencil - "+this.tagID+": was not passed in data"),!1;var d=this.destination,e=!1,h;if(null==c){c=$(d);if("none"===d||"none"===b||"string"===b||"fragment"===b)if("none"===b||"string"===b||"fragment"===b)h=$(document.createElement("div"));else return stencil.util.log('Stencil: Only render output type "none", "fragment" or "string" is supported for stencils with no destination'),!1;else h=c.filter(":first").clone();e=!0}else h=c.find(d.replace(/\\(?=\{|\})/g,
"\\\\\\"));var n=this.template,k=this.childStencils,g=this.isStandard;if(h.length)"append"===b||"prepend"===b?(this.existingContent=h.html(),h.empty()):"none"===b?(c.empty(),h.empty()):"string"!==b&&"fragment"!==b&&h.empty();else return stencil.util.log("Stencil: Destination ID - "+d+" not found!"),!1;a.forEach(function(b,a){b.lpIdx=a;b.ctIdx=a+1;for(var c=n;0<=c.search(/\{\{[\w.]*\}\}/);)var e=c.match(/\{\{[\w.]*\}\}/)[0],e=e.substring(2,e.length-2),f=stencil.util.getKeyValue(b,e),f=null==f?"":f,
c=c.replace("{{"+e+"}}",f);var l=h;g&&(e=stencil.util.createWrapper(h,"stencil-replicator","append"),l=h.find(e));l.append(c);g||l.removeClass(d.replace(".",""));Object.keys(k).forEach(function(a){var c=b[a];null!=b.global&&(Array.isArray(c)?c.forEach(function(a){a.global=b.global}):stencil.util.isObject(c)&&(c.global=b.global));k[a].render(c,null,l)});l.find("select[data-stencilselector]").each(function(){var a=this.getAttribute("data-stencilselector");stencil.util.selectOption($(this),stencil.util.getKeyValue(b,
a))})});"prepend"===b&&h.append(this.existingContent);if(e){stencil.util.cleanUpStencils(h);if("none"===b||"fragment"===b)return h.children();if("string"===b)return h.html();"append"!==b&&c.empty();c.append(h.children());return!0}}}},k=function(b){var a=e(b.tagID,b.destination,b.template);Object.keys(b.childStencils).forEach(function(c){a.childStencils[c]=k(b.childStencils[c])});return a},g;if(null!=stencil.stencilHolder[a]){a=stencil.stencilHolder[a];var f=k(a);null==d&&(d=stencil.util.createWrapper($(a.destination),
c||stencil.opts.defaultOutputElement,"after"));f.destination=d;return f}f=b||$("#"+stencil.util.escapeCSS(a));if(f.length)null==d&&(d=f.attr("data-stencilDestination")),null==d&&(d=stencil.util.createWrapper(f,c||stencil.opts.defaultOutputElement,"after")),b=f.detach();else return stencil.util.log("Stencil: Tag ID '"+a+"' provided is not found!"),null;null!=b.attr("data-childStencil")&&""!=b.attr("data-childStencil")&&(null==g&&(g=[]),b.attr("data-childStencil").split(" ").forEach(function(b){""!=
b&&g.push(b)}));var m={};stencil.util.log("Stencil: Searching for child stencils in "+a);0!==b.find("stencil").length&&(m=stencil.util.findStencils(b));stencil.util.log("Stencil: Completed child stencil generation for "+a+", "+Object.keys(m).length+" child stencil");null!=g&&g.forEach(function(a){stencil.util.log("Stencil: Building specified child stencil: "+a);var c=b.find("#"+stencil.util.escapeCSS(a));if(c.length){var d=stencil.util.guid();c.addClass(d);m[a]=e(a,"."+d,c.html());m[a].isStandard=
!1;c.empty()}else stencil.util.log("Stencil: Specified child stencil: "+a+" not found!")});d=e(a,d,b.html());d.childStencils=m;return stencil.stencilHolder[a]=d},build:function(a){a=null==a?$("body"):$("#"+a);return 0===a.length?(stencil.util.log("Stencil: Unable to start build process as starting element ID cannot be found"),null):stencil.util.findStencils(a)},util:{guid:function(){var a=(new Date).getTime();window.performance&&"function"===typeof window.performance.now&&(a+=performance.now());return"stencil-"+
"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"==d?c:c&3|8).toString(16)})},selectOption:function(a,d){a.children().each(function(){if(this.value==d)return this.setAttribute("selected",""),!1})},outerHTML:function(a){return a.clone().wrap("<p>").parent().html()},createWrapper:function(a,d,c){var b=stencil.util.guid(),e=document.createElement(stencil.opts.ieNs+d);e.className=""===e.className?b:e.className+" "+b;a[c](e);
return stencil.util.escapeCSS(stencil.opts.ieNs)+d+"."+b},findStencils:function(a){function d(b,a){for(var c=b.childNodes,g=0;g<c.length;g++){var f;f=c[g];f="STENCIL"===f.nodeName||"stencil"===f.nodeName?!0:!1;f?a[c[g].id]=stencil.define(c[g].id,null,"stencil-output",$(c[g])):d(c[g],a)}}var c={};d(a.get(0),c);return c},cleanUpStencils:function(a){function d(a){if(function(a){return 0<=a.nodeName.indexOf("STENCIL")||0<=a.nodeName.indexOf("stencil")?!0:!1}(a))0===a.childNodes.length&&a.parentNode.removeChild(a),
$(a).children().unwrap().each(function(){d(this)});else{a=a.childNodes;for(var b=0;b<a.length;b++)d(a[b])}}a.children().each(function(){d(this)})},escapeCSS:function(a){a=String(a);for(var d=a.length,c=-1,b,e="",k=a.charCodeAt(0);++c<d;){b=a.charCodeAt(c);if(0==b)throw new InvalidCharacterError("Invalid character: the input contains U+0000.");e=1<=b&&31>=b||127==b||0==c&&48<=b&&57>=b||1==c&&48<=b&&57>=b&&45==k?e+("\\"+b.toString(16)+" "):128<=b||45==b||95==b||48<=b&&57>=b||65<=b&&90>=b||97<=b&&122>=
b?e+a.charAt(c):e+("\\"+a.charAt(c))}return e},getKeyValue:function(a,d){var c;d.split(/[\.\[\]]/).every(function(b,e){if(""===b)return!0;c=0===e?null==a[b]?stencil.util.log("Stencil: "+b+" of "+d+" not found"):a[b]:null==c[b]?stencil.util.log("Stencil: "+b+" of "+d+" not found"):c[b];return null!=c?!0:!1});return c},isIE:function(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("msie")?parseInt(a.split("msie")[1]):!1},isObject:function(a){return a===Object(a)},log:function(a){stencil.opts.debug&&
console.log(a)}}}}());(function(){var a=stencil.util.isIE();0!=a&&10>a&&(document.createElement("stencil"),document.createElement("stencil-replicator"),document.createElement("stencil-output"),stencil.opts.ieNs="STENCIL:")})(); //# sourceMappingURL=stencil-15.0.min.map
